<!DOCTYPE html>
<html>
<head>
    <title>Opening Obsidian for Daddy ðŸ¥°</title>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const urlParams = new URLSearchParams(window.location.search);
            let obsidianURLParam = urlParams.get('obsidian_url'); // This contains the full Obsidian URL
            let vault = "Arquitech"; // Default vault name
            let filepath = "";

            if (obsidianURLParam) {
                // Decode the full Obsidian URL parameter
                let decodedObsidianURL = decodeURIComponent(obsidianURLParam);

                // Extract the actual query parameters from the decoded URL
                let internalParams = new URLSearchParams(decodedObsidianURL.split("?")[1]);

                if (internalParams.has("file")) {
                    filepath = decodeURIComponent(internalParams.get("file"));
                } else if (internalParams.has("filepath")) {
                    filepath = decodeURIComponent(internalParams.get("filepath"));
                }
            }

            if (filepath) {
                // Step 1: First, open Obsidian itself
                const openObsidianVaultURL = `obsidian://open?vault=${encodeURIComponent(vault)}`;
                window.location.href = openObsidianVaultURL;

                // Step 2: Wait 5 seconds, then open the file
                setTimeout(() => {
                    const newObsidianURL = `obsidian://advanced-uri?vault=${encodeURIComponent(vault)}&filepath=${encodeURIComponent(filepath)}&openmode=true`;

                    // Debug: Show the generated Obsidian URL
                    document.getElementById("debugOutput").innerText = newObsidianURL;
                    document.getElementById("manualLink").href = newObsidianURL;
                    document.getElementById("manualLink").innerText = "Click here to open in Obsidian";

                    // Redirect to the correct file after Obsidian has loaded
                    window.location.href = newObsidianURL;
                }, 5000); // 5-second delay to ensure Obsidian is fully open
            } else {
                document.getElementById("debugOutput").innerText = "No valid filepath detected!";
            }
        });
    </script>
</head>
<body>
    <p>Opening Obsidian...... Please wait. If nothing happens, <a id="manualLink">click here</a>.</p>
    <p><strong>Generated Obsidian URL:</strong> <span id="debugOutput" style="word-break: break-all;"></span></p>
</body>
</html>
